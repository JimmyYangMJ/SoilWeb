<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>土壤水势</title>

    <!-- Bootstrap core CSS-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <!--  Paper Dashboard core CSS  页面动画-->
    <link href="assets/css/paper-dashboard.css" rel="stylesheet"/>

    <link rel="import" href="sidebar.html" id="siderbar"/>
    <link rel="import" href="navbar.html" id="navbar"/>

    <!--   Core JS Files   -->
    <script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- ECharts单文件引入 -->
    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
<!--    <script type="text/javascript" src="js/echarts.js"></script>-->

    <!-- Paper Dashboard Core javascript and methods for Demo purpose -->
    <script src="assets/js/paper-dashboard.js"></script>

    <script>
        //将集合中的数据保留两位小数
        //生成图标的方法
        function generateChart(data) {
            require.config({
                paths: {
                    echarts: 'http://echarts.baidu.com/build/dist'
                }
            });
            course = data;
            var status = course.status;

            if(status == 1){  //  没有相应记录
                alert("没有相应记录")
            }
            var node = course.data;
            var nodeTime = new Array();
            var nodeHumidity = new Array();
            for (var i = 0; i < node.length; i++) {
                nodeTime[i] = node[i].times;
                nodeHumidity[i] = node[i].humidity;
            }
// 使用
            require(
                [
                    'echarts',
                    'echarts/chart/line' ,// 使用柱状图就加载bar模块，按需加载
                    'echarts/chart/bar'
                ],
                function (ec) {
                    // 基于准备好的dom，初始化echarts图表
                    var myChart = ec.init(document.getElementById('echart'));

                    option = {
                        title : {
                            text: '土壤水势',
                            subtext: course.msg
                        },
                        tooltip : {
                            trigger: 'axis'
                        },
                        legend: {
                            data:['节点一','节点二']
                        },
                        toolbox: {
                            show : true,
                            feature : {
                                mark : {show: true},
                                dataView : {show: true, readOnly: false},
                                magicType : {show: true, type: ['line', 'bar']},
                                restore : {show: true},
                                saveAsImage : {show: true}
                            }
                        },
                        calculable : true,
                        xAxis : [
                            {
                                type : 'category',
                                boundaryGap : false,
                                data: nodeTime
                                // data : ['00：00','1：00','2：00','3：00','4：00','5：00','6：00','7:00','8:00',
                                //     '9：00','10：00','11：00','12：00','13：00','14：00','15：00','16:00','17:00'
                                // ,'18:00', '19：00','20：00','21：00','22：00','23:00']
                            }
                        ],
                        yAxis : [
                            {
                                type : 'value',
                                axisLabel : {
                                    formatter: '{value} pa'
                                }
                            }
                        ],
                        series : [
                            {
                                name:'节点一',
                                type:'line',
                                data:nodeHumidity,
                                // data:[11, 50, 15, 13, 12, 13, 10,9],
                                markPoint : {
                                    data : [
                                        {type : 'max', name: '最大值'},
                                        {type : 'min', name: '最小值'}
                                    ]
                                },
                                markLine : {
                                    data : [
                                        {type : 'average', name: '平均值'}
                                    ]
                                }
                            },
                            {
                                name:'节点二',
                                type:'line',
                                data:[1, -2, 2, 5, 3, 2, 0,4],
                                markPoint : {
                                    data : [
                                        {name : '周最低', value : -2, xAxis: 1, yAxis: -1.5}
                                    ]
                                },
                                markLine : {
                                    data : [
                                        {type : 'average', name : '平均值'}
                                    ]
                                }
                            }
                        ]
                    };

                    // 为echarts对象加载数据
                    myChart.setOption(option);
                }
            );
        }

        //buttion调用的方法
        function getData() {
            var node = $('#node').val();
            var day = $('#day').val();
            alert("结点："+node + " 时间：" + day);
            //异步请求
            $.get(  // jQuery post() 方法
                "soil/selectSoilSet.do", //访问地址
                {node: node, day: day}, //携带的参数
                function (data) {
                    generateChart(data);
                },
                "json"
            );
        }
    </script>

</head>
<body>
    <div class="wrapper">
        <!-- 引入侧边栏-->
        <script type="text/javascript">
            document.write(siderbar.import.body.innerHTML);
        </script>
        <!--2. 主窗口-->
        <div class="main-panel">
            <!-- 引入侧边栏-->
            <script type="text/javascript">
                document.write(navbar.import.body.innerHTML);
            </script>
            <!--内容-->
            <div class="content">
                <div class="container-fluid">
                    <div class="row">

                        <div align="center">
                            <label for="start">开始日期：</label><input id="start" type="date" value="2018-08-13"/>
                            <label for="end">结束日期：</label><input id="end" type="date" value="2018-08-16"/>
                            <button οnclick="#">查询</button>
                        </div>
                        <!--查询表单-->
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <label for="node" class="col-sm-2 control-label">结点</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="node" placeholder="例如：1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="day" class="col-sm-2 control-label">时间</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="day" placeholder="例如：2019-09-22">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="button" class="btn btn-simple" onclick="getData()">查询</button>
                                </div>
                            </div>
                        </form>
                        <!--查询表单-->
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="content">
                                    <!--折线图-->
                                    <div id="echart" class="ct-chart">当前没有数据</div>
                                    <!--折线图-->
                                    <div class="footer">
                                        <hr>
                                        <div class="stats">
                                            <i class=""></i> 3秒前更新
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--内容-->

        </div>
        <!--2. 主窗口-->
    </div>

</body>

</html>
